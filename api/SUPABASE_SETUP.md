# Supabase-Setup für die Koscher-Bestenliste

Diese Seite ist nun vorbereitet, direkt auf Supabase zuzugreifen.

## 1) Tabellenschema korrigieren (`score` als Zahl)

Falls `score` irrtümlich als `text` angelegt wurde, in Supabase SQL Editor ausführen:

```sql
alter table public.leaderboard
  alter column score type integer using nullif(trim(score), '')::integer;
```

Falls einzelne alte Werte nicht als Zahl geparst werden können, zuerst bereinigen oder alternativ:

```sql
alter table public.leaderboard
  add column score_int integer;

update public.leaderboard
set score_int = nullif(trim(score), '')::integer
where score ~ '^[0-9]+$';

alter table public.leaderboard drop column score;
alter table public.leaderboard rename column score_int to score;
```

## 2) Empfohlenes Schema

```sql
create table if not exists public.leaderboard (
  id bigint generated by default as identity primary key,
  name text not null check (char_length(name) <= 20),
  score integer not null check (score >= 0),
  created_at timestamptz not null default now()
);
```

## 3) Row Level Security (RLS) für öffentliche Rangliste

```sql
alter table public.leaderboard enable row level security;

create policy "public can read leaderboard"
on public.leaderboard
for select
using (true);

create policy "public can insert leaderboard"
on public.leaderboard
for insert
with check (
  char_length(name) between 1 and 20
  and score >= 0
  and score <= 999999
);
```

## 4) Hinweise

- Das Frontend liest/schreibt über `rest/v1/leaderboard`.
- Danach weiterhin im Spiel nur die besten 5 Einträge (pro Name der beste Score).
- Misslingt Supabase, fällt das Spiel auf die bestehende API-/LocalStorage-Strategie zurück.
